# ============================================================================
# DEPLOYMENT SEPARATION: PAGES vs WORKER
# ============================================================================
#
# This repository has TWO completely independent deployments with path-based
# triggering to ensure they never deploy unnecessarily.
#
# 1. PAGES (Frontend - qcv2):
#    • Triggers: Only when frontend code changes (see deploy-pages.yml paths)
#    • Deployment: GitHub Actions using cloudflare/pages-action@v1
#    • Config: No wrangler.toml needed (uses action parameters)
#    • Build: npm run build:pages → pages/dist/
#    • URL: https://qcv2.pages.dev
#
# 2. WORKER (Image Proxy API - authentiqc-worker):
#    • Triggers: Only when workers/ directory changes
#    • Deployment: GitHub Actions using wrangler CLI
#    • Config: workers/image-proxy/wrangler.toml (name = "authentiqc-worker")
#    • URL: https://authentiqc-worker.adwate.workers.dev
#
# ============================================================================
# CRITICAL: NO ROOT WRANGLER.TOML
# ============================================================================
#
# There is NO root wrangler.toml file in this repository.
#
# WHY THIS MATTERS:
# • Pages deployment uses cloudflare/pages-action@v1 which takes parameters
#   directly (projectName, directory) and does NOT need wrangler.toml
# • Worker deployment uses workers/image-proxy/wrangler.toml exclusively
# • Having a root wrangler.toml causes NAME CONFLICTS during worker deployment
# • Wrangler would find the root config and use "qcv2" instead of "authentiqc-worker"
# • This causes the worker deployment to fail or overwrite the Pages deployment
#
# THE PROBLEM THIS SOLVES:
# Previously, a root wrangler.toml (name = "qcv2") existed as a "fallback" for
# dashboard deployments. This caused critical issues:
# • Worker deployments failed with "Worker name mismatch" errors
# • CI expected "authentiqc-worker" but found "qcv2" from root config
# • The worker URL served Pages HTML instead of the worker API
# • Confusion about which config file controls which deployment
#
# THE SOLUTION:
# • Removed root wrangler.toml entirely
# • Pages deployment: GitHub Actions only (cloudflare/pages-action@v1)
# • Worker deployment: Uses workers/image-proxy/wrangler.toml only
# • Path-based triggers: Each workflow only runs when relevant files change
# • Clear separation: No config file conflicts
#
# ============================================================================
# PATH-BASED TRIGGERING
# ============================================================================
#
# Pages Workflow (.github/workflows/deploy-pages.yml):
#   Triggers on changes to:
#   • Frontend code: pages/**
#   • Workflow file: .github/workflows/deploy-pages.yml
#
# Worker Workflow (.github/workflows/deploy-workers.yml):
#   Triggers on changes to:
#   • Worker directory: workers/**
#   • Workflow file: .github/workflows/deploy-workers.yml
#
# This means:
# ✓ Changing frontend code → Only Pages deploys
# ✓ Changing worker code → Only Worker deploys
# ✓ Changing both → Both deploy (as they should)
# ✓ No redundant deployments
#
# ============================================================================
# CLOUDFLARE PAGES DASHBOARD CONFIGURATION
# ============================================================================
#
# Pages deployment is handled EXCLUSIVELY by GitHub Actions.
# DO NOT configure a build command in the Cloudflare Pages dashboard.
#
# Recommended Cloudflare Pages dashboard settings:
#
# Build configuration:
#   Framework preset:  None
#   Build command:     [LEAVE EMPTY]
#   Build output dir:  [LEAVE EMPTY]
#   Root directory:    /
#
# Deploy configuration:
#   All deployments are handled by GitHub Actions
#   The cloudflare/pages-action@v1 uploads the pre-built files
#
# Why no dashboard build command?
# • Prevents duplicate/conflicting deployments
# • Ensures consistent builds via GitHub Actions
# • Avoids wrangler.toml conflicts
# • Single source of truth for deployment configuration
#
# ============================================================================
# DEPLOYMENT WORKFLOWS
# ============================================================================
#
# Pages Deployment:
#   Workflow: .github/workflows/deploy-pages.yml
#   Trigger:  Push to main + pages/ code changes OR manual dispatch
#   Steps:    Install → Build → Deploy via cloudflare/pages-action@v1
#   Config:   No wrangler.toml (uses action parameters)
#   Parameters: projectName=qcv2, directory=pages/dist
#
# Worker Deployment:
#   Workflow: .github/workflows/deploy-workers.yml
#   Trigger:  Push to main + workers/ code changes OR manual dispatch
#   Steps:    Install → Deploy via wrangler CLI
#   Config:   workers/image-proxy/wrangler.toml
#   Working Directory: workers/image-proxy
#
# Manual Deployment Triggers:
#   Both workflows can be triggered manually from GitHub Actions UI
#   using workflow_dispatch events
#
# ============================================================================
# TROUBLESHOOTING
# ============================================================================
#
# Worker not deploying:
#   → Check if workers/ files changed in your commit
#   → Path-based trigger means worker only deploys when its code changes
#   → Use workflow_dispatch to manually trigger deployment if needed
#   → Verify workers/image-proxy/wrangler.toml exists with name = "authentiqc-worker"
#
# Pages deploying when it shouldn't:
#   → Check .github/workflows/deploy-pages.yml paths configuration
#   → Ensure your changes didn't touch pages/ files
#
# Worker name mismatch error:
#   → This was caused by a root wrangler.toml file (now removed)
#   → If error persists, check that NO wrangler.toml exists at repository root
#   → Only workers/image-proxy/wrangler.toml should exist
#   → Worker should deploy with name "authentiqc-worker" only
#
# Worker returning HTML instead of JSON:
#   → Worker is not deployed or deployment failed
#   → Check GitHub Actions logs for deployment errors
#   → Manually trigger deploy-workers.yml workflow
#   → Test after deployment: curl https://authentiqc-worker.adwate.workers.dev/
#
# Both deploying unnecessarily:
#   → This is expected if changes affect both (e.g., root package.json)
#   → Workflow file changes trigger their respective workflows
#
# ============================================================================
